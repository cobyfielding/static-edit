{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/block.ts","src/editable.ts","src/editor.ts","src/image.ts","src/line.ts"],"names":[],"mappings":"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","file":"static-edit.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","import {Editable} from './editable'\n\nexport class Block extends Editable {\n    createField(): HTMLInputElement {\n        return <any>document.createElement('textarea')\n    }\n}\n","import {Editor} from './editor'\n\nexport abstract class Editable {\n    protected elem: HTMLElement\n    protected editor: Editor\n    private changed: boolean\n\n    constructor(elem: HTMLElement, editor: Editor) {\n        this.elem = elem\n        this.editor = editor\n    }\n\n    bindEvents() {\n        this.elem.addEventListener('click', (e) => {\n            e.stopPropagation()\n            e.preventDefault()\n\n            if (!this.editor.editionStarted(this.elem, this.elem.innerText)) {\n                return false\n            }\n\n            const input = this.createField()\n            input.value = this.elem.innerText\n\n            input.addEventListener('blur', () => {\n                const oldValue = this.elem.innerText\n                const newValue = input.value\n\n                this.elem.innerText = newValue\n                this.changed = true\n                input.parentNode.replaceChild(this.elem, input)\n\n                // Make sure that no one triggers a new click on an editable while this is running\n                setTimeout(() => this.editor.editionEnded(this.elem, oldValue, newValue), 100)\n            })\n\n            input.addEventListener('click', (e) => {\n                e.stopPropagation()\n                e.preventDefault()\n            })\n\n            let resize = () => {\n                input.style.height = 'auto'\n                input.style.height = input.scrollHeight + 'px'\n            }\n\n            // Workaround for cut, paste, drop and keydown\n            let delayedResize = () => window.setTimeout(resize, 0)\n\n            input.addEventListener('change', resize)\n            input.addEventListener('cut', delayedResize)\n            input.addEventListener('paste', delayedResize)\n            input.addEventListener('drop', delayedResize)\n            input.addEventListener('keydown', delayedResize)\n\n            input.style.width = 'auto'\n            input.style.height = this.elem.offsetHeight + 'px'\n            input.style.overflowY = \"hidden\"\n            input.style.fontSize = window.getComputedStyle(this.elem).fontSize\n\n            this.elem.parentNode.replaceChild(input, this.elem)\n            input.focus()\n            resize()\n        }, true)\n    }\n\n    abstract createField(): HTMLInputElement\n\n    get value(): string {\n        return this.elem.textContent\n    }\n\n    get element(): HTMLElement {\n        return this.elem\n    }\n\n    get hasChanged(): boolean {\n        return this.changed\n    }\n}\n","import {Block} from './block'\nimport {Line} from './line'\nimport {Image} from './image'\nimport {Editable} from './editable'\n\nexport type Options = {\n    saveButton: boolean,\n    selector: string,\n}\n\nexport class Editor {\n    private editing: boolean\n    private elems: Editable[]\n    private selector: string = '.editable'\n\n    constructor(private options: Options) {\n        this.handleOptions()\n\n        this.elems = []\n        const elems: NodeListOf<Element> = document.querySelectorAll(this.selector)\n\n        for (let i = 0; i < elems.length; ++i) {\n            let elm: Editable\n\n            if (elems[i].tagName === 'P') {\n                elm = new Block(<HTMLElement>elems[i], this)\n            } else if (elems[i].tagName === 'IMG') {\n                elm = new Image(<HTMLElement>elems[i], this)\n            } else {\n                elm = new Line(<HTMLElement>elems[i], this)\n            }\n\n            elm.bindEvents()\n            this.elems.push(elm)\n        }\n    }\n\n    handleOptions() {\n        if (this.options.saveButton === true) {\n            this.createSaveButton()\n        }\n\n        if (this.options.selector !== undefined) {\n            this.selector = this.options.selector\n        }\n    }\n\n    private createSaveButton() {\n        const button = document.createElement('button')\n        button.addEventListener('click', (e) => {\n            e.preventDefault()\n            e.stopPropagation()\n\n            window.dispatchEvent(\n                new CustomEvent('static_edit.saving', {detail: {changed: this.elems.filter((e) => e.hasChanged)}})\n            )\n        })\n\n        button.textContent = 'Save'\n        button.style.position = 'absolute'\n        button.style.top = '20px'\n        button.style.left = '20px'\n        document.body.appendChild(button)\n    }\n\n    editionStarted(elem: HTMLElement, oldValue: string) {\n        if (this.editing) {\n            return false\n        }\n\n        this.editing = true\n\n        window.dispatchEvent(new CustomEvent('static_edit.editing', {detail: {elem, oldValue}}))\n\n        return true\n    }\n\n    editionEnded(elem: HTMLElement, oldValue: string, newValue: string) {\n        this.editing = false\n\n        window.dispatchEvent(new CustomEvent('static_edit.edited', {detail: {elem, oldValue, newValue}}))\n    }\n}\n","import {Editable} from \"./editable\"\n\ninterface FileReaderEventTarget extends EventTarget {\n    result:string\n}\n\nexport class Image extends Editable {\n    elem: HTMLImageElement\n\n    createField(): HTMLInputElement {\n        const input = document.createElement('input')\n\n        input.type = 'file'\n        input.style.display = 'none'\n\n        return input\n    }\n\n    bindEvents() {\n        this.elem.addEventListener('click', (e) => {\n            e.stopPropagation()\n            e.preventDefault()\n\n            const file = this.createField()\n            file.addEventListener('change', () => {\n                const uploadedFile = file.files[0]\n                if (!!uploadedFile.type.match(/image.*/)) {\n                    const reader = new FileReader()\n                    reader.addEventListener('loadend', (e: ProgressEvent) => {\n                        const newValue = (<FileReaderEventTarget>e.target).result\n                        const oldValue = this.elem.src\n\n                        this.elem.src = newValue\n                        this.elem.dataset.fileName = uploadedFile.name\n                        this.elem.parentNode.removeChild(file)\n\n                        setTimeout(() => this.editor.editionEnded(this.elem, oldValue, newValue), 100)\n                    })\n\n                    reader.readAsDataURL(uploadedFile)\n                }\n            })\n\n            this.elem.parentNode.appendChild(file)\n            file.click()\n        }, true)\n    }\n}\n","import {Editable} from './editable'\n\nexport class Line extends Editable {\n    createField(): HTMLInputElement {\n        return document.createElement('input')\n    }\n}\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYmxvY2sudHMiLCJzcmMvZWRpdGFibGUudHMiLCJzcmMvZWRpdG9yLnRzIiwic3JjL2ltYWdlLnRzIiwic3JjL2xpbmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7QUNBQSx1Q0FBbUM7QUFFbkM7SUFBMkIseUJBQVE7SUFBbkM7O0lBSUEsQ0FBQztJQUhHLDJCQUFXLEdBQVg7UUFDSSxNQUFNLENBQU0sUUFBUSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQTtJQUNsRCxDQUFDO0lBQ0wsWUFBQztBQUFELENBSkEsQUFJQyxDQUowQixtQkFBUSxHQUlsQztBQUpZLHNCQUFLOzs7OztBQ0FsQjtJQUtJLGtCQUFZLElBQWlCLEVBQUUsTUFBYztRQUN6QyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQTtRQUNoQixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQTtJQUN4QixDQUFDO0lBRUQsNkJBQVUsR0FBVjtRQUFBLGlCQW9EQztRQW5ERyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFDLENBQUM7WUFDbEMsQ0FBQyxDQUFDLGVBQWUsRUFBRSxDQUFBO1lBQ25CLENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQTtZQUVsQixFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLEtBQUksQ0FBQyxJQUFJLEVBQUUsS0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzlELE1BQU0sQ0FBQyxLQUFLLENBQUE7WUFDaEIsQ0FBQztZQUVELElBQU0sS0FBSyxHQUFHLEtBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQTtZQUNoQyxLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFBO1lBRWpDLEtBQUss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LFlBQVksQ0FBQyxDQUFBO2dCQUN0QyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUE7WUFFRixLQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUE7WUFDdEMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFBO1FBQ2hCLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUNaLENBQUM7SUFDTCxZQUFDO0FBQUQsQ0F6Q0EsQUF5Q0MsQ0F6QzBCLG1CQUFRLEdBeUNsQztBQXpDWSxzQkFBSzs7Ozs7Ozs7Ozs7Ozs7O0FDTmxCLHVDQUFtQztBQUVuQztJQUEwQix3QkFBUTtJQUFsQzs7SUFJQSxDQUFDO0lBSEcsMEJBQVcsR0FBWDtRQUNJLE1BQU0sQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQzFDLENBQUM7SUFDTCxXQUFDO0FBQUQsQ0FKQSxBQUlDLENBSnlCLG1CQUFRLEdBSWpDO0FBSlksb0JBQUkiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiaW1wb3J0IHtFZGl0YWJsZX0gZnJvbSAnLi9lZGl0YWJsZSdcblxuZXhwb3J0IGNsYXNzIEJsb2NrIGV4dGVuZHMgRWRpdGFibGUge1xuICAgIGNyZWF0ZUZpZWxkKCk6IEhUTUxJbnB1dEVsZW1lbnQge1xuICAgICAgICByZXR1cm4gPGFueT5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpXG4gICAgfVxufVxuIiwiaW1wb3J0IHtFZGl0b3J9IGZyb20gJy4vZWRpdG9yJ1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRWRpdGFibGUge1xuICAgIHByb3RlY3RlZCBlbGVtOiBIVE1MRWxlbWVudFxuICAgIHByb3RlY3RlZCBlZGl0b3I6IEVkaXRvclxuICAgIHByaXZhdGUgY2hhbmdlZDogYm9vbGVhblxuXG4gICAgY29uc3RydWN0b3IoZWxlbTogSFRNTEVsZW1lbnQsIGVkaXRvcjogRWRpdG9yKSB7XG4gICAgICAgIHRoaXMuZWxlbSA9IGVsZW1cbiAgICAgICAgdGhpcy5lZGl0b3IgPSBlZGl0b3JcbiAgICB9XG5cbiAgICBiaW5kRXZlbnRzKCkge1xuICAgICAgICB0aGlzLmVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG5cbiAgICAgICAgICAgIGlmICghdGhpcy5lZGl0b3IuZWRpdGlvblN0YXJ0ZWQodGhpcy5lbGVtLCB0aGlzLmVsZW0uaW5uZXJUZXh0KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBpbnB1dCA9IHRoaXMuY3JlYXRlRmllbGQoKVxuICAgICAgICAgICAgaW5wdXQudmFsdWUgPSB0aGlzLmVsZW0uaW5uZXJUZXh0XG5cbiAgICAgICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLmVsZW0uaW5uZXJUZXh0XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBpbnB1dC52YWx1ZVxuXG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtLmlubmVyVGV4dCA9IG5ld1ZhbHVlXG4gICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VkID0gdHJ1ZVxuICAgICAgICAgICAgICAgIGlucHV0LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKHRoaXMuZWxlbSwgaW5wdXQpXG5cbiAgICAgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCBubyBvbmUgdHJpZ2dlcnMgYSBuZXcgY2xpY2sgb24gYW4gZWRpdGFibGUgd2hpbGUgdGhpcyBpcyBydW5uaW5nXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmVkaXRvci5lZGl0aW9uRW5kZWQodGhpcy5lbGVtLCBvbGRWYWx1ZSwgbmV3VmFsdWUpLCAxMDApXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgbGV0IHJlc2l6ZSA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBpbnB1dC5zdHlsZS5oZWlnaHQgPSAnYXV0bydcbiAgICAgICAgICAgICAgICBpbnB1dC5zdHlsZS5oZWlnaHQgPSBpbnB1dC5zY3JvbGxIZWlnaHQgKyAncHgnXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFdvcmthcm91bmQgZm9yIGN1dCwgcGFzdGUsIGRyb3AgYW5kIGtleWRvd25cbiAgICAgICAgICAgIGxldCBkZWxheWVkUmVzaXplID0gKCkgPT4gd2luZG93LnNldFRpbWVvdXQocmVzaXplLCAwKVxuXG4gICAgICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCByZXNpemUpXG4gICAgICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjdXQnLCBkZWxheWVkUmVzaXplKVxuICAgICAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigncGFzdGUnLCBkZWxheWVkUmVzaXplKVxuICAgICAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGRlbGF5ZWRSZXNpemUpXG4gICAgICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZGVsYXllZFJlc2l6ZSlcblxuICAgICAgICAgICAgaW5wdXQuc3R5bGUud2lkdGggPSAnYXV0bydcbiAgICAgICAgICAgIGlucHV0LnN0eWxlLmhlaWdodCA9IHRoaXMuZWxlbS5vZmZzZXRIZWlnaHQgKyAncHgnXG4gICAgICAgICAgICBpbnB1dC5zdHlsZS5vdmVyZmxvd1kgPSBcImhpZGRlblwiXG4gICAgICAgICAgICBpbnB1dC5zdHlsZS5mb250U2l6ZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXMuZWxlbSkuZm9udFNpemVcblxuICAgICAgICAgICAgdGhpcy5lbGVtLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGlucHV0LCB0aGlzLmVsZW0pXG4gICAgICAgICAgICBpbnB1dC5mb2N1cygpXG4gICAgICAgICAgICByZXNpemUoKVxuICAgICAgICB9LCB0cnVlKVxuICAgIH1cblxuICAgIGFic3RyYWN0IGNyZWF0ZUZpZWxkKCk6IEhUTUxJbnB1dEVsZW1lbnRcblxuICAgIGdldCB2YWx1ZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtLnRleHRDb250ZW50XG4gICAgfVxuXG4gICAgZ2V0IGVsZW1lbnQoKTogSFRNTEVsZW1lbnQge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtXG4gICAgfVxuXG4gICAgZ2V0IGhhc0NoYW5nZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNoYW5nZWRcbiAgICB9XG59XG4iLCJpbXBvcnQge0Jsb2NrfSBmcm9tICcuL2Jsb2NrJ1xuaW1wb3J0IHtMaW5lfSBmcm9tICcuL2xpbmUnXG5pbXBvcnQge0ltYWdlfSBmcm9tICcuL2ltYWdlJ1xuaW1wb3J0IHtFZGl0YWJsZX0gZnJvbSAnLi9lZGl0YWJsZSdcblxuZXhwb3J0IHR5cGUgT3B0aW9ucyA9IHtcbiAgICBzYXZlQnV0dG9uOiBib29sZWFuLFxuICAgIHNlbGVjdG9yOiBzdHJpbmcsXG59XG5cbmV4cG9ydCBjbGFzcyBFZGl0b3Ige1xuICAgIHByaXZhdGUgZWRpdGluZzogYm9vbGVhblxuICAgIHByaXZhdGUgZWxlbXM6IEVkaXRhYmxlW11cbiAgICBwcml2YXRlIHNlbGVjdG9yOiBzdHJpbmcgPSAnLmVkaXRhYmxlJ1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBvcHRpb25zOiBPcHRpb25zKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlT3B0aW9ucygpXG5cbiAgICAgICAgdGhpcy5lbGVtcyA9IFtdXG4gICAgICAgIGNvbnN0IGVsZW1zOiBOb2RlTGlzdE9mPEVsZW1lbnQ+ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLnNlbGVjdG9yKVxuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZWxlbXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGxldCBlbG06IEVkaXRhYmxlXG5cbiAgICAgICAgICAgIGlmIChlbGVtc1tpXS50YWdOYW1lID09PSAnUCcpIHtcbiAgICAgICAgICAgICAgICBlbG0gPSBuZXcgQmxvY2soPEhUTUxFbGVtZW50PmVsZW1zW2ldLCB0aGlzKVxuICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtc1tpXS50YWdOYW1lID09PSAnSU1HJykge1xuICAgICAgICAgICAgICAgIGVsbSA9IG5ldyBJbWFnZSg8SFRNTEVsZW1lbnQ+ZWxlbXNbaV0sIHRoaXMpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGVsbSA9IG5ldyBMaW5lKDxIVE1MRWxlbWVudD5lbGVtc1tpXSwgdGhpcylcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxtLmJpbmRFdmVudHMoKVxuICAgICAgICAgICAgdGhpcy5lbGVtcy5wdXNoKGVsbSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhhbmRsZU9wdGlvbnMoKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2F2ZUJ1dHRvbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVTYXZlQnV0dG9uKClcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2VsZWN0b3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RvciA9IHRoaXMub3B0aW9ucy5zZWxlY3RvclxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjcmVhdGVTYXZlQnV0dG9uKCkge1xuICAgICAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKVxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpXG5cbiAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KFxuICAgICAgICAgICAgICAgIG5ldyBDdXN0b21FdmVudCgnc3RhdGljX2VkaXQuc2F2aW5nJywge2RldGFpbDoge2NoYW5nZWQ6IHRoaXMuZWxlbXMuZmlsdGVyKChlKSA9PiBlLmhhc0NoYW5nZWQpfX0pXG4gICAgICAgICAgICApXG4gICAgICAgIH0pXG5cbiAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gJ1NhdmUnXG4gICAgICAgIGJ1dHRvbi5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSdcbiAgICAgICAgYnV0dG9uLnN0eWxlLnRvcCA9ICcyMHB4J1xuICAgICAgICBidXR0b24uc3R5bGUubGVmdCA9ICcyMHB4J1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGJ1dHRvbilcbiAgICB9XG5cbiAgICBlZGl0aW9uU3RhcnRlZChlbGVtOiBIVE1MRWxlbWVudCwgb2xkVmFsdWU6IHN0cmluZykge1xuICAgICAgICBpZiAodGhpcy5lZGl0aW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZWRpdGluZyA9IHRydWVcblxuICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ3N0YXRpY19lZGl0LmVkaXRpbmcnLCB7ZGV0YWlsOiB7ZWxlbSwgb2xkVmFsdWV9fSkpXG5cbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG5cbiAgICBlZGl0aW9uRW5kZWQoZWxlbTogSFRNTEVsZW1lbnQsIG9sZFZhbHVlOiBzdHJpbmcsIG5ld1ZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5lZGl0aW5nID0gZmFsc2VcblxuICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ3N0YXRpY19lZGl0LmVkaXRlZCcsIHtkZXRhaWw6IHtlbGVtLCBvbGRWYWx1ZSwgbmV3VmFsdWV9fSkpXG4gICAgfVxufVxuIiwiaW1wb3J0IHtFZGl0YWJsZX0gZnJvbSBcIi4vZWRpdGFibGVcIlxuXG5pbnRlcmZhY2UgRmlsZVJlYWRlckV2ZW50VGFyZ2V0IGV4dGVuZHMgRXZlbnRUYXJnZXQge1xuICAgIHJlc3VsdDpzdHJpbmdcbn1cblxuZXhwb3J0IGNsYXNzIEltYWdlIGV4dGVuZHMgRWRpdGFibGUge1xuICAgIGVsZW06IEhUTUxJbWFnZUVsZW1lbnRcblxuICAgIGNyZWF0ZUZpZWxkKCk6IEhUTUxJbnB1dEVsZW1lbnQge1xuICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0JylcblxuICAgICAgICBpbnB1dC50eXBlID0gJ2ZpbGUnXG4gICAgICAgIGlucHV0LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSdcblxuICAgICAgICByZXR1cm4gaW5wdXRcbiAgICB9XG5cbiAgICBiaW5kRXZlbnRzKCkge1xuICAgICAgICB0aGlzLmVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG5cbiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmNyZWF0ZUZpZWxkKClcbiAgICAgICAgICAgIGZpbGUuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHVwbG9hZGVkRmlsZSA9IGZpbGUuZmlsZXNbMF1cbiAgICAgICAgICAgICAgICBpZiAoISF1cGxvYWRlZEZpbGUudHlwZS5tYXRjaCgvaW1hZ2UuKi8pKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKClcbiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlbmQnLCAoZTogUHJvZ3Jlc3NFdmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSAoPEZpbGVSZWFkZXJFdmVudFRhcmdldD5lLnRhcmdldCkucmVzdWx0XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMuZWxlbS5zcmNcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtLnNyYyA9IG5ld1ZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW0uZGF0YXNldC5maWxlTmFtZSA9IHVwbG9hZGVkRmlsZS5uYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChmaWxlKVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuZWRpdG9yLmVkaXRpb25FbmRlZCh0aGlzLmVsZW0sIG9sZFZhbHVlLCBuZXdWYWx1ZSksIDEwMClcbiAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTCh1cGxvYWRlZEZpbGUpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgdGhpcy5lbGVtLnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQoZmlsZSlcbiAgICAgICAgICAgIGZpbGUuY2xpY2soKVxuICAgICAgICB9LCB0cnVlKVxuICAgIH1cbn1cbiIsImltcG9ydCB7RWRpdGFibGV9IGZyb20gJy4vZWRpdGFibGUnXG5cbmV4cG9ydCBjbGFzcyBMaW5lIGV4dGVuZHMgRWRpdGFibGUge1xuICAgIGNyZWF0ZUZpZWxkKCk6IEhUTUxJbnB1dEVsZW1lbnQge1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKVxuICAgIH1cbn1cbiJdfQ=="}